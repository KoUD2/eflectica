<div class="O_EffectFavorite">
  <% unless current_user.favorites.exists?(effect_id: effect.id) %>
    <div class="A_FavoriteIcon">
      <%= form_with url: favorites_path, method: :post, data: { behavior: 'prevent-navigation' }, remote: true do %>
        <%= hidden_field_tag "favorite[effect_id]", effect.id %>
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="16" viewBox="0 0 18 16" fill="none" class="favorite-icon" onclick="this.closest('form').submit();">
          <path d="M9 15.6496C8.79 15.6496 8.5764 15.6135 8.3592 15.5414C8.142 15.4693 7.9506 15.3539 7.785 15.1952L6.2325 13.8318C4.6425 12.4324 3.2061 11.0439 1.9233 9.66638C0.6405 8.28887 -0.000599579 6.77027 4.20757e-07 5.11057C4.20757e-07 3.75442 0.472501 2.62189 1.4175 1.71298C2.3625 0.804065 3.54 0.349609 4.95 0.349609C5.745 0.349609 6.495 0.51177 7.2 0.836093C7.905 1.16042 8.505 1.60419 9 2.16743C9.495 1.60477 10.095 1.16128 10.8 0.836959C11.505 0.512636 12.255 0.350186 13.05 0.349609C14.46 0.349609 15.6375 0.804065 16.5825 1.71298C17.5275 2.62189 18 3.75442 18 5.11057C18 6.76969 17.3625 8.29176 16.0875 9.67676C14.8125 11.0618 13.365 12.454 11.745 13.8534L10.215 15.1952C10.05 15.3539 9.8589 15.4693 9.6417 15.5414C9.4245 15.6135 9.2106 15.6496 9 15.6496ZM8.145 3.89869C7.71 3.30718 7.245 2.85618 6.75 2.54571C6.255 2.23524 5.655 2.08029 4.95 2.08087C4.05 2.08087 3.3 2.36941 2.7 2.9465C2.1 3.52358 1.8 4.24494 1.8 5.11057C1.8 5.86078 2.0775 6.65803 2.6325 7.50231C3.1875 8.34658 3.8514 9.16518 4.6242 9.9581C5.397 10.751 6.192 11.494 7.0092 12.1871C7.8264 12.8802 8.49 13.45 9 13.8967C9.51 13.4495 10.1739 12.8796 10.9917 12.1871C11.8095 11.4946 12.6045 10.7516 13.3767 9.9581C14.1489 9.1646 14.8125 8.346 15.3675 7.50231C15.9225 6.6586 16.2 5.86136 16.2 5.11057C16.2 4.24494 15.9 3.52358 15.3 2.9465C14.7 2.36941 13.95 2.08087 13.05 2.08087C12.345 2.08087 11.745 2.2361 11.25 2.54658C10.755 2.85705 10.29 3.30775 9.855 3.89869C9.75 4.04296 9.6225 4.15116 9.4725 4.2233C9.3225 4.29544 9.165 4.3315 9 4.3315C8.835 4.3315 8.6775 4.29544 8.5275 4.2233C8.3775 4.15116 8.25 4.04296 8.145 3.89869Z" fill="#0E1111"/>
        </svg>
      <% end %>  
    </div>
  <% else %>
    <div class='Q_FavoriteRec'></div>
    <div class="A_FavoriteIcon">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="16" viewBox="0 0 18 16" fill="none">
        <path d="M9 15.6496C8.79 15.6496 8.5764 15.6135 8.3592 15.5414C8.142 15.4693 7.9506 15.3539 7.785 15.1952L6.2325 13.8318C4.6425 12.4324 3.2061 11.0439 1.9233 9.66638C0.640501 8.28887 -0.000599579 6.77027 4.20757e-07 5.11057C4.20757e-07 3.75442 0.4725 2.62189 1.4175 1.71298C2.3625 0.804065 3.54 0.349609 4.95 0.349609C5.745 0.349609 6.495 0.51177 7.2 0.836093C7.905 1.16042 8.505 1.60419 9 2.16743C9.495 1.60477 10.095 1.16128 10.8 0.836959C11.505 0.512636 12.255 0.350186 13.05 0.349609C14.46 0.349609 15.6375 0.804065 16.5825 1.71298C17.5275 2.62189 18 3.75442 18 5.11057C18 6.76969 17.3625 8.29176 16.0875 9.67676C14.8125 11.0618 13.365 12.454 11.745 13.8534L10.215 15.1952C10.05 15.3539 9.8589 15.4693 9.6417 15.5414C9.4245 15.6135 9.2106 15.6496 9 15.6496ZM8.145 3.89869C7.71 3.30718 7.245 2.85618 6.75 2.54571C6.255 2.23524 5.655 2.08029 4.95 2.08087C4.05 2.08087 3.3 2.36941 2.7 2.9465C2.1 3.52358 1.8 4.24494 1.8 5.11057C1.8 5.86078 2.0775 6.65803 2.6325 7.50231C3.1875 8.34658 3.8514 9.16518 4.6242 9.9581C5.397 10.751 6.192 11.494 7.0092 12.1871C7.8264 12.8802 8.49 13.45 9 13.8967C9.51 13.4495 10.1739 12.8796 10.9917 12.1871C11.8095 11.4946 12.6045 10.7516 13.3767 9.9581C14.1489 9.1646 14.8125 8.346 15.3675 7.50231C15.9225 6.65861 16.2 5.86136 16.2 5.11057C16.2 4.24494 15.9 3.52358 15.3 2.9465C14.7 2.36941 13.95 2.08087 13.05 2.08087C12.345 2.08087 11.745 2.2361 11.25 2.54658C10.755 2.85705 10.29 3.30775 9.855 3.89869C9.75 4.04296 9.6225 4.15116 9.4725 4.2233C9.3225 4.29544 9.165 4.3315 9 4.3315C8.835 4.3315 8.6775 4.29544 8.5275 4.2233C8.3775 4.15116 8.25 4.04296 8.145 3.89869Z" fill="#E33081"/>
        <path d="M5.5 1.34961L9 3.84961L13 1.34961L15.5 2.34961L17 5.34961L14.5 9.34961L9 14.3496L3.5 9.34961L1 5.34961L2.5 2.34961L5.5 1.34961Z" fill="#E33081"/>
      </svg>
    </div>
    <div class='Q_FavoriteRec Q_FavoriteRecBottom'></div>
  <% end %>

  

  <%= link_to effect, class: "O_AQuestion" do %>
    <div class='O_EffectFavoriteButton'>
      <div class='Q_PhotoEffect'>
        <%= image_tag(effect.img.url, alt: "Картинка") %>
      </div>

      <div class='W_EffectBody'>
        <h2 class='A_TextH2 A_TextH2Effect'><%= effect.name %></h2>
        <p class='A_TextXS A_TextXSEffect'><%= effect.description %></p>
        <div class='С_EffectFooter'>
          <div class='M_EffectFooter'>
            <div class='A_TagProgram'>
              <% if effect.programs.present? %>
                <% programs = Array(effect.programs.split(',')).map(&:strip) %>

                <% if programs.length == 1 %>
                  <div class='Q_PhotoProgram'>
                    <%= image_tag(SERVICES[programs.first]["image_url"], alt: SERVICES[programs.first]["name"]) %>
                  </div>
                  <p class='A_TextXS'><%= SERVICES[programs.first]["name"] %></p>
                <% else %>

                  <% programs.each do |program| %>
                    <% if SERVICES.key?(program) %>
                      <div class='Q_PhotoProgram'>
                        <%= image_tag(SERVICES[program]["image_url"], alt: SERVICES[program]["name"]) %>
                      </div>
                    <% end %>
                  <% end %>
                <% end %>
              <% else %>
                <p>Программы отсутствуют</p>
              <% end %>

            </div>
            <div class='A_TagProgram'>
              <% if effect.devices.present? %>
                <% Array(effect.devices.split(',')).each do |device| %>
                  <% if DEVICES.key?(device.strip) %>
                    <div class='Q_PhotoProgram'>
                      <%= image_tag(DEVICES[device.strip]["image_url"], alt:DEVICES[device.strip]["name"]) %>
                    </div>
                  <% else %>
                    <p>Устройство <%= device.strip %> не найдено в DEVICES</p>
                  <% end %>
                <% end %>
              <% else %>
                <p>Устройства отсутствуют</p>
              <% end %>         
            </div>
          </div>
          <div class='M_RaitingEffect'>
            <%= image_tag("Q_StarIcon.svg", alt: "Картинка рейтинга", class: "Q_StarIcon") %>
            <p class='A_TextXS A_TextXSRaitingCount'><%= effect.ratings.average(:number).to_f.round(2) || 0 %></p>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>